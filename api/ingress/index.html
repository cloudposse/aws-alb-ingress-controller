



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.6">
    
    
      
        <title>Ingress Resources - AWS ALB Ingress Controller</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="green">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#ingress-resources" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="AWS ALB Ingress Controller" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                AWS ALB Ingress Controller
              </span>
              <span class="md-header-nav__topic">
                Ingress Resources
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/kubernetes-sigs/aws-alb-ingress-controller/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      kubernetes-sigs/aws-alb-ingress-controller
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." title="Home" class="md-tabs__link">
          Home
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../guide/controller/setup/" title="Setup" class="md-tabs__link">
          Setup
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../guide/controller/config/" title="Guide" class="md-tabs__link">
          Guide
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../CONTRIBUTING/" title="About" class="md-tabs__link">
          About
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="AWS ALB Ingress Controller" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    AWS ALB Ingress Controller
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/kubernetes-sigs/aws-alb-ingress-controller/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      kubernetes-sigs/aws-alb-ingress-controller
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Home
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Home
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Welcome" class="md-nav__link">
      Welcome
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/controller/how-it-works/" title="How it works" class="md-nav__link">
      How it works
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Setup
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/controller/setup/" title="Setup ALB ingress controller" class="md-nav__link">
      Setup ALB ingress controller
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/external-dns/setup/" title="Setup External DNS" class="md-nav__link">
      Setup External DNS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      Controller
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Controller
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/controller/config/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Ingress
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Ingress
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/ingress/annotation/" title="Annotation" class="md-nav__link">
      Annotation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/ingress/spec/" title="Spec" class="md-nav__link">
      Spec
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      Walkthrough
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        Walkthrough
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/walkthrough/echoserver/" title="Echo server" class="md-nav__link">
      Echo server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../CONTRIBUTING/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../BUILDING/" title="Building" class="md-nav__link">
      Building
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ROADMAP/" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ingress-behavior" title="Ingress Behavior" class="md-nav__link">
    Ingress Behavior
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#annotations" title="Annotations" class="md-nav__link">
    Annotations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#services" title="Services" class="md-nav__link">
    Services
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optional-service-annotations" title="Optional Service Annotations" class="md-nav__link">
    Optional Service Annotations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/kubernetes-sigs/aws-alb-ingress-controller/edit/master/docs/api/ingress.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="ingress-resources">Ingress Resources<a class="headerlink" href="#ingress-resources" title="Permanent link">&para;</a></h1>
<p>This document covers how ingress resources work in relation to The ALB Ingress Controller.</p>
<h2 id="ingress-behavior">Ingress Behavior<a class="headerlink" href="#ingress-behavior" title="Permanent link">&para;</a></h2>
<p>Periodically, ingress update events are seen by the controller. The controller retains a list of all ingress resources it knows about, along with the current state of AWS components that satisfy them. When an update event is fired, the controller re-scans the list of ingress resources known to the cluster and determines, by comparing the list to its previously stored one, the ingresses requiring deletion, creation or modification.</p>
<p>An example ingress, from <code class="codehilite">example/2048/2048-ingress.yaml</code> is as follows.</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;nginx-ingress&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">namespace</span><span class="p p-Indicator">:</span> <span class="s">&quot;2048-game&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">annotations</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">kubernetes.io/ingress.class</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">alb</span>
  <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2048-nginx-ingress</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">rules</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2048.example.com</span>
      <span class="l l-Scalar l-Scalar-Plain">http</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">paths</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
            <span class="l l-Scalar l-Scalar-Plain">backend</span><span class="p p-Indicator">:</span>
              <span class="l l-Scalar l-Scalar-Plain">serviceName</span><span class="p p-Indicator">:</span> <span class="s">&quot;service-2048&quot;</span>
              <span class="l l-Scalar l-Scalar-Plain">servicePort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
</pre></div>

<p>The host field specifies the eventual Route 53-managed domain that will route to this service. The service, service-2048, must be of type NodePort (see <a href="../../examples/echoservice/echoserver-service.yaml">../examples/echoservice/echoserver-service.yaml</a>) in order for the provisioned ALB to route to it. If no NodePort exists, the controller will not attempt to provision resources in AWS. For details on purpose of annotations seen above, see <a href="#annotations">Annotations</a>.</p>
<h2 id="annotations">Annotations<a class="headerlink" href="#annotations" title="Permanent link">&para;</a></h2>
<p>The ALB Ingress Controller is configured by Annotations on the <code class="codehilite">Ingress</code> and <code class="codehilite">Service</code> resource objects.</p>
<div class="codehilite"><pre><span></span>alb.ingress.kubernetes.io/load-balancer-attributes
alb.ingress.kubernetes.io/backend-protocol
alb.ingress.kubernetes.io/certificate-arn
alb.ingress.kubernetes.io/healthcheck-interval-seconds
alb.ingress.kubernetes.io/healthcheck-path
alb.ingress.kubernetes.io/healthcheck-port
alb.ingress.kubernetes.io/healthcheck-protocol
alb.ingress.kubernetes.io/healthcheck-timeout-seconds
alb.ingress.kubernetes.io/healthy-threshold-count
alb.ingress.kubernetes.io/unhealthy-threshold-count
alb.ingress.kubernetes.io/listen-ports
alb.ingress.kubernetes.io/inbound-cidrs
alb.ingress.kubernetes.io/target-type
alb.ingress.kubernetes.io/scheme
alb.ingress.kubernetes.io/security-groups
alb.ingress.kubernetes.io/subnets
alb.ingress.kubernetes.io/success-codes
alb.ingress.kubernetes.io/tags
alb.ingress.kubernetes.io/target-group-attributes
alb.ingress.kubernetes.io/ip-address-type
alb.ingress.kubernetes.io/ssl-policy
alb.ingress.kubernetes.io/actions.&lt;ACTION NAME&gt;
</pre></div>

<ul>
<li>
<p><strong>load-balancer-attributes</strong>: Defines <a href="http://docs.aws.amazon.com/elasticloadbalancing/latest/APIReference/API_LoadBalancerAttribute.html">Load Balancer Attributes</a> that should be applied to the ALB. This can be used to enable the S3 access logs feature of the ALB. Example: <code class="codehilite">alb.ingress.kubernetes.io/load-balancer-attributes: access_logs.s3.enabled=true,access_logs.s3.bucket=my-access-log-bucket</code></p>
</li>
<li>
<p><strong>backend-protocol</strong>: Enables selection of protocol for ALB to use to connect to backend service. When omitted, <code class="codehilite">HTTP</code> is used.</p>
</li>
<li>
<p><strong>certificate-arn</strong>: Enables HTTPS and uses the certificate defined, based on arn, stored in your <a href="https://aws.amazon.com/certificate-manager">AWS Certificate Manager</a>.</p>
</li>
<li>
<p><strong>healthcheck-interval-seconds</strong>: The approximate amount of time, in seconds, between health checks of an individual target. The default is 15 seconds.</p>
</li>
<li>
<p><strong>healthcheck-path</strong>: The ping path that is the destination on the targets for health checks. The default is /.</p>
</li>
<li>
<p><strong>healthcheck-port</strong>: The port the load balancer uses when performing health checks on targets. The default is traffic-port, which indicates the port on which each target receives traffic from the load balancer.</p>
</li>
<li>
<p><strong>healthcheck-protocol</strong>: The protocol the load balancer uses when performing health checks on targets. The default is the HTTP protocol.</p>
</li>
<li>
<p><strong>healthcheck-timeout-seconds</strong>: The amount of time, in seconds, during which no response from a target means a failed health check. The default is 5 seconds.</p>
</li>
<li>
<p><strong>healthcheck-healthy-threshold-count</strong>: The number of consecutive health checks successes required before considering an unhealthy target healthy. The default is 2.</p>
</li>
<li>
<p><strong>healthcheck-unhealthy-threshold-count</strong>: The number of consecutive health check failures required before considering a target unhealthy. The default is 2.</p>
</li>
<li>
<p><strong>listen-ports</strong>: Defines the ports the ALB will expose. It defaults to <code class="codehilite">[{&quot;HTTP&quot;: 80}]</code> unless a certificate ARN is defined, then it is <code class="codehilite">[{&quot;HTTPS&quot;: 443}]</code>. Uses a format as follows '[{"HTTP":8080,"HTTPS": 443}]'.</p>
</li>
<li>
<p><strong>inbound-cidrs</strong>: Defines the CIDR whitelist for ingress traffic to ALB. It defaults to <code class="codehilite">0.0.0.0/0</code>.(Will be ignored if <strong>security-groups</strong> is specified)</p>
</li>
<li>
<p><strong>target-type</strong>: Defines if the EC2 instance ID or the pod IP are used in the managed Target Groups. Defaults to <code class="codehilite">instance</code>. Valid options are <code class="codehilite">instance</code> and <code class="codehilite">ip</code>. With <code class="codehilite">instance</code> the Target Group targets are <code class="codehilite">&lt;ec2 instance id&gt;:&lt;node port&gt;</code>, for <code class="codehilite">ip</code> the targets are <code class="codehilite">&lt;pod ip&gt;:&lt;pod port&gt;</code>. <code class="codehilite">ip</code> is to be used when the pod network is routable and can be reached by the ALB.</p>
</li>
<li>
<p><strong>scheme</strong>: Defines whether an ALB should be <code class="codehilite">internal</code> or <code class="codehilite">internet-facing</code>. See <a href="http://docs.aws.amazon.com/elasticloadbalancing/latest/userguide/how-elastic-load-balancing-works.html#load-balancer-scheme">Load balancer scheme</a> in the AWS documentation for more details.</p>
</li>
<li>
<p><strong>security-groups</strong>: <a href="http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_SecurityGroups.html">Security groups</a> that should be applied to the ALB instance. These can be referenced by security group IDs or the name tag associated with each security group. Example ID values are <code class="codehilite">sg-723a380a,sg-a6181ede,sg-a5181edd</code>. Example tag values are <code class="codehilite">appSG, webSG</code>. When the annotation is not present, the controller will create a security group with appropriate ports allowing access to <code class="codehilite">0.0.0.0/0</code> and attached to the ALB. It will also create a security group for instances that allows all TCP traffic when the source is the security group created for the ALB.</p>
</li>
<li>
<p><strong>subnets</strong>: The subnets where the ALB instance should be deployed. Must include 2 subnets, each in a different <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html">availability zone</a>. These can be referenced by subnet IDs or the name tag associated with the subnet. Example values for subnet IDs are <code class="codehilite">subnet-a4f0098e,subnet-457ed533,subnet-95c904cd</code>. Example values for name tags are: <code class="codehilite">webSubnet,appSubnet</code>. If subnets are not specified the ALB controller will attempt to detect qualified subnets. This qualification is done by locating subnets that match the following criteria.</p>
</li>
<li>
<p><code class="codehilite">kubernetes.io/cluster/$CLUSTER_NAME</code> where <code class="codehilite">$CLUSTER_NAME</code> is the same cluster name specified on the ingress controller. The value of this tag must be <code class="codehilite">shared</code> or <code class="codehilite">owned</code>.</p>
</li>
<li>
<p><code class="codehilite">kubernetes.io/role/internal-elb</code> should be set to <code class="codehilite">1</code> or an empty tag value for internal load balancers.</p>
</li>
<li>
<p><code class="codehilite">kubernetes.io/role/elb</code> should be set to <code class="codehilite">1</code> or an empty tag value for internet-facing load balancers.</p>
</li>
<li>
<p>After subnets matching the above 2 tags have been located, they are checked to ensure 2 or more are in unique AZs, otherwise the ALB will not be created. If 2 subnets share the same AZ, only 1 of the 2 is used.</p>
</li>
<li>
<p><strong>success-codes</strong>: Defines the HTTP status code that should be expected when doing health checks against the defined <code class="codehilite">healthcheck-path</code>. When omitted, <code class="codehilite">200</code> is used.</p>
</li>
<li>
<p><strong>tags</strong>: Defines <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Using_Tags.html">AWS Tags</a> that should be applied to ALB instance, Target groups and SecurityGroups.</p>
</li>
<li>
<p><strong>target-group-attributes</strong>: Defines <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-target-groups.html#target-group-attributes">Target Group Attributes</a> which can be assigned to the Target Groups. Currently these are applied equally to all target groups in the ingress.</p>
</li>
<li>
<p><strong>ip-address-type</strong>: The IP address type thats used to either route IPv4 traffic only or to route both IPv4 and IPv6 traffic. Can be either <code class="codehilite">dualstack</code> or <code class="codehilite">ipv4</code>. When omitted <code class="codehilite">ipv4</code> is used.</p>
</li>
<li>
<p><strong>ssl-policy</strong>: Defines the <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/create-https-listener.html#describe-ssl-policies">Security Policy</a> that should be assigned to the ALB, allowing you to control the protocol and ciphers.</p>
</li>
<li>
<p><strong>alb.ingress.kubernetes.io/actions.\<ACTION NAME></strong>: Provides a method for configuring custom actions on a listener, such as for <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html#redirect-actions">Redirect Actions</a>. The <code class="codehilite">&lt;ACTION NAME&gt;</code> in the annotation must match the <code class="codehilite">serviceName</code> in the ingress rules. The value of the annotation is the JSON spec of the action. See the <a href="https://docs.aws.amazon.com/sdk-for-go/api/service/elbv2/#Action">Action type</a> for documentation on what should be in the JSON. <em>NOTE</em> you must set the <code class="codehilite">servicePort</code> to <code class="codehilite">use-annotation</code>.</p>
</li>
<li>For a fixed-response, use <code class="codehilite">alb.ingress.kubernetes.io/actions.fixed-response-error: &#39;{&quot;Type&quot;: &quot;fixed-response&quot;, &quot;FixedResponseConfig&quot;: {&quot;ContentType&quot;:&quot;text/plain&quot;, &quot;StatusCode&quot;:&quot;503&quot;, &quot;MessageBody&quot;:&quot;503 error text&quot;}}&#39;</code> with a <code class="codehilite"><span class="n">serviceName</span><span class="o">:</span> <span class="n">fixed</span><span class="o">-</span><span class="n">response</span><span class="o">-</span><span class="n">error</span></code> and <code class="codehilite"><span class="n">servicePort</span><span class="o">:</span> <span class="n">use</span><span class="o">-</span><span class="n">annotation</span></code>.</li>
<li>For a HTTP to HTTPS redirect, use <code class="codehilite">alb.ingress.kubernetes.io/actions.redirect: {&quot;Type&quot;: &quot;redirect&quot;, &quot;RedirectConfig&quot;: { &quot;Protocol&quot;: &quot;HTTPS&quot;, &quot;StatusCode&quot;: &quot;HTTP_301&quot;}}</code> with <code class="codehilite"><span class="n">serviceName</span><span class="o">:</span> <span class="n">redirect</span></code> and <code class="codehilite"><span class="n">servicePort</span><span class="o">:</span> <span class="n">use</span><span class="o">-</span><span class="n">annotation</span></code>.</li>
</ul>
<h3 id="services">Services<a class="headerlink" href="#services" title="Permanent link">&para;</a></h3>
<p>A subset of these annotations are supported on Services. This is used to customize the Target Group created for the Service. If a Service has no annotations, the Target Group options will default to the same options configured on the Ingress.</p>
<h4 id="optional-service-annotations">Optional Service Annotations<a class="headerlink" href="#optional-service-annotations" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>alb.ingress.kubernetes.io/backend-protocol
alb.ingress.kubernetes.io/healthcheck-interval-seconds
alb.ingress.kubernetes.io/healthcheck-path
alb.ingress.kubernetes.io/healthcheck-port
alb.ingress.kubernetes.io/healthcheck-protocol
alb.ingress.kubernetes.io/healthcheck-timeout-seconds
alb.ingress.kubernetes.io/healthy-threshold-count
alb.ingress.kubernetes.io/unhealthy-threshold-count
alb.ingress.kubernetes.io/target-type
alb.ingress.kubernetes.io/success-codes
alb.ingress.kubernetes.io/target-group-attributes
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.5e60981f.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>